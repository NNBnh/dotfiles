#!/bin/sh

# Install ------------------------------------------------------------------------------------------

# DNF
sudo dnf copr enable --assumeyes peterwu/iosevka
sudo dnf install --assumeyes papirus-icon-theme iosevka-curly-fonts ibus-unikey


# Flatpak
flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

utilities='org.gnome.Extensions com.usebottles.bottles org.js.nuclear.Nuclear'
tools='com.visualstudio.code org.blender.Blender org.godotengine.Godot'
games='com.valvesoftware.Steam org.libretro.RetroArch org.polymc.PolyMC sh.ppy.osu'
flatpak install --assumeyes flathub $utilities $tools $games


# Homebrew
bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
sudo dnf groupinstall --assumeyes 'Development Tools'
printf '%s' 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.bash_profile
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

cli_utilities='ruby zsh zplug starship trash-cli p7zip'
cli_medias='ffmpeg imagemagick gifski asciinema'
cli_funs='figlet genact cmatrix no-more-secrets'
brew install $cli_utilities $cli_medias $cli_funs


# Config -------------------------------------------------------------------------------------------

# Gnome
# TODO
# - https://github.com/velitasali/gtktitlebar
# - https://github.com/GSConnect/gnome-shell-extension-gsconnect
gsettings set org.gnome.desktop.interface icon-theme Papirus

bash -c "$(curl -fsSL https://raw.githubusercontent.com/rafaelmardojai/firefox-gnome-theme/master/scripts/install-by-curl.sh)"


# Zsh
cat > ~/.zshrc << ZSHRC
source "\${HOMEBREW_PREFIX}/var/homebrew/linked/zplug/init.zsh"

zplug zdharma/fast-syntax-highlighting
zplug zsh-users/zsh-autosuggestions
zplug marlonrichert/zsh-autocomplete

zplug check || zplug install
zplug load

eval "\$(starship init zsh)"

setopt histreduceblanks histignorespace histignorealldups autocd autopushd pushdminus pushdsilent \\
       pushdtohome pushdignoredups nohup extendedglob globdots automenu cdablevars listpacked \\
       nolisttypes alwaystoend correct no_nomatch rmstarsilent

alias md='mkdir -p'
alias dl='trash-put'
alias a='7z'
alias g='git'

chpwd() { ls --almost-all --group-directories-first }
s() { selection=(); for item in "\$@"; do selection+=("\$(readlink -f "\${item}")"); done }
mv() { if [ "\$#" -eq 0 ]; then command mv    "\${selection[@]}" .; else command mv    "\$@"; fi }
cp() { if [ "\$#" -eq 0 ]; then command cp -r "\${selection[@]}" .; else command cp -r "\$@"; fi }
ln() { if [ "\$#" -eq 0 ]; then command ln -s "\${selection[@]}" .; else command ln -s "\$@"; fi }

export HISTSIZE=500000
export HISTFILE="\${HOME}/.history"
export SAVEHIST="\${HISTSIZE}"
ZSHRC

# Git
git config --global user.email nnbnh@protonmail.com
git config --global user.name NNB
git config --global credential.helper store
git config --global pull.rebase true

mkdir -p ~/.local/share
curl -fsSL https://raw.githubusercontent.com/GitAlias/gitalias/main/gitalias.txt > ~/.local/share/gitalias.txt
git config --global include.path ~/.local/share/gitalias.txt